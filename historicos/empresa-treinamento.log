-- Criação do banco

CREATE DATABASE empresa_treinamento;
USE empresa_treinamento;

-- Criaçao da tabela departamento


CREATE TABLE tb_departamento( 
id_departamento INT AUTO_INCREMENT PRIMARY KEY, 
nome VARCHAR(100) NOT NULL, 
andar INT NOT NULL
);


-- Criaçao da tabela de funcionario

CREATE TABLE tb_funcionario( 
id_funcionario INT AUTO_INCREMENT PRIMARY KEY, 
nome VARCHAR(100) NOT NULL, 
cpf CHAR(11) UNIQUE, salario DECIMAL(10,2), 
id_departamento_fk INT NOT NULL, 
FOREIGN KEY (id_departamento_fk) REFERENCES tb_departamento(id_departamento) 
);

-- Criaçao da tabela de projeto

CREATE TABLE tb_projeto( 
id_projeto INT AUTO_INCREMENT, 
nome_projeto VARCHAR(100) NOT NULL, 
id_departamento_fk INT NOT NULL, 
PRIMARY KEY (id_projeto, id_departamento_fk), FOREIGN KEY (id_departamento_fk) REFERENCES tb_departamento(id_departamento) 
);

-- Criaçao da tabela associativa


CREATE TABLE tb_funcionario_projeto( 
id_funcionario_fk INT NOT NULL, 
id_projeto_fk INT NOT NULL, 
id_departamento INT NOT NULL, 
PRIMARY KEY (id_funcionario_fk, id_projeto_fk, id_departamento),
FOREIGN KEY (id_funcionario_fk) REFERENCES tb_funcionario(id_funcionario),
FOREIGN KEY (id_projeto_fk, id_departamento) REFERENCES tb_projeto(id_projeto, id_departamento_fk) 
);

-- Adiciona campo de email
ALTER TABLE tb_funcionario ADD email VARCHAR(120) UNIQUE NOT NULL


-- Renomeia campo andar

ALTER TABLE tb_departamento RENAME COLUMN andar TO numero_andar

-- Adiciona a tabela de projeto, campo de data_inicio
ALTER TABLE tb_projeto ADD data_inicio DATE;

-- Remove fks
ALTER TABLE tb_funcionario_projeto DROP tb_funcionario_projeto_ibfk_2;
ALTER TABLE tb_funcionario_projeto DROP id_projeto_fk ;
ALTER TABLE tb_funcionario_projeto DROP FOREIGN KEY tb_funcionario_projeto_ibfk_2

-- deleta tabela projeto
DROP TABLE tb_projeto;

